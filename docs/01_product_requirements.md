# プロダクト要求仕様概要

最終更新日: 2026-02-23

## 1. 目的

- 本プロダクトは、自宅に設置した自家発電設備の発電状況を記録することを目的とする。
- 記録したデータを Web ベースの画面で可視化し、発電状況の把握・振り返りを行えるようにする。

## 2. 想定ユーザー

- 主な利用者は、発電設備を設置している本人（管理者）を想定する。
- 必要に応じて、将来的に複数ユーザー対応を検討できる構成を目指す（現時点では未確定）。

## 3. 提供する機能（概要）

### 3.1 発電状況データの記録

- 自宅に設置したデバイス、または PC から本プロダクトの API エンドポイントに対して `POST` リクエストを送信し、発電状況を記録する。
- 記録対象は、事前に登録した以下の情報の組み合わせに対する履歴データとする。
    - 物理量単位（例: `kWh`, `Ah`, `W`, `V`, `A`）
    - データラベル（例: `BatteryVoltage`, `ArrayVoltage`）
    - 対象サブシステム（例: `Battery`, `Array`, `WindTurbine`, `Controller`）
- 履歴データは、`monitored_at`（UTC 固定 / RFC3339 形式）、`value`（数値: 整数または小数）、物理量単位 `unit`（文字列）、
  データラベル `data_label`（文字列）、対象サブシステム `subsystem`（文字列）を指定して登録する。
- 同一送信元からの記録は、`10秒以上` のインターバルを空けるものとする。
- `10秒未満` の間隔で送信された場合はエラーとする（バックエンド未実装）。

### 3.2 発電状況データの可視化

- 記録されたデータを Web ベースの画面で可視化する。
- 直近で必要な可視化機能として、日毎の折れ線グラフを 1 画面に表示する。
- 表示対象期間は過去 1 か月分とする。
- グラフは `data_label` ごとに色分けし、複数ラベルを同一画面上に重ねて表示する。
- 将来的には、ラベルごとの表示 ON/OFF、期間指定、CSV 出力、リアルタイム描画に対応できる構成を目指す。

### 3.3 ログイン機能（アクセス制御）

- Web 画面にはログイン機能を備える。
- ログインしていないユーザーは可視化画面を閲覧できない。
- 可視化画面は認証済みユーザーのみアクセス可能とする（認証方式の詳細は未確定）。
- 現時点では、発電状況記録用 API の `POST` は認証なしで利用可能とする。
- 将来的には JWT トークン発行機能を追加し、API 認証（JWT ベース）を導入可能な構成を目指す。

## 4. 利用イメージ（業務フロー / 操作フロー）

1. 自宅のデバイスまたは PC が、発電状況データを API に `POST` する。
2. 本プロダクトが受信したデータを保存する（同一送信元の短すぎる送信間隔はエラー）。
3. 利用者が Web 画面にログインする。
4. 利用者が可視化画面で、蓄積された発電状況データを閲覧する。

## 5. システム境界（現時点）

- 本プロダクトが担う範囲:
    - 発電状況データの受信（API）
    - データの保存
    - 認証付き Web 画面での可視化
- 本プロダクトの外部:
  - 発電状況データを生成する自宅側デバイス
  - データ送信元としての PC
- 利用形態は、インターネット経由での外部公開を前提とする。

## 6. 前提・制約（現時点）

- 可視化は Web ブラウザで利用する。
- データ登録は API 経由で行い、Web 画面からの手入力は現時点では要件に含めない（未確定）。
- 可視化画面は認証必須とする。
- 発電状況記録用 API は現時点では認証なしで運用し、将来的な JWT 認証導入を考慮する。
- 利用環境は、外部公開（インターネット経由）を前提とする。
- データ保持期間は無期限とし、欠損データは補完せずそのまま扱う。重複データが発生した場合は後着データで上書きする。
- 通知要件（メール / Webhook 等）は現時点では要件に含めない。

## 7. 未確定事項（確認したい点）

以下は要求仕様として今後決める必要がある項目です。実装や API 設計に影響が大きいため、優先して確認したいです。

1. データ送信頻度・粒度
    - 未確定: 「同一送信元」の判定方法（`device_id` 等）
    - 未確定: `10秒未満` の送信時に返すエラーコード / エラー仕様
2. 可視化の要件（将来拡張）
   - 未確定: ラベルごとの表示 ON/OFF、期間指定、CSV 出力、リアルタイム描画の実装時期・優先度
3. ログイン対象の範囲
    - 現時点は Web 可視化画面のみ認証必須（API `POST` は認証なし）
    - 将来は JWT による API 認証導入を想定
4. API の送信元認証方式
    - 現時点は認証なし
    - 将来案として JWT を想定（導入タイミング・移行方針は未確定）

## 8. 次の整理候補（要求仕様詳細化）

- API 入力仕様（リクエストボディ、必須項目、認証方式）
- 可視化画面の最小要件（画面一覧、表示項目、フィルタ条件）
- 認証要件（ユーザー種別、セッション管理、パスワードポリシー）
- 非機能要件（可用性、バックアップ、セキュリティ、家庭内運用前提の制約）
