# アーキテクチャ設計

最終更新日: 2026-02-25

## 1. 目的

- 本ドキュメントは、システム構成とレイヤ責務を整理する。
- 現時点では学習・スパイク段階のため、実装済みの内容を優先して記載し、未実装部分は今後の拡張方針として分離する。

## 2. 全体構成

- Rust バックエンド API（`axum + utoipa + SeaORM`）
- TanStack Start ベースの Web フロントエンド（SSR 対応）
- frontend（TanStack Start）の API ルートで Better Auth を提供
- DB は PostgreSQL を想定
- コンテナ構成は未確定（ローカル開発は Docker Compose 、本番環境はECSを予定）

### 2.1 構成イメージ

1. 自宅デバイス / PC がバックエンド API に発電データを `POST`
2. バックエンドが DB に保存
3. ユーザーがフロントエンド Web 画面にアクセス
4. フロントエンドは認証（Better Auth）を使って可視化画面を提供（可視化本体は今後実装）

## 3. バックエンドアーキテクチャ（`backend/`）

### 3.1 レイヤ構成と責務

オニオンアーキテクチャを採用し、各層の責務を以下のように分類する。

- プレゼンテーション
    - HTTP ルーティング、リクエスト/レスポンス DTO、OpenAPI 公開
    - 入口レイヤとして use-case を呼び出す
- インフラストラクチャ
    - SeaORM モデル、Repository 実装、DB 接続、Unit of Work 実装
    - DB 依存の詳細を use-case 層から隠蔽
- インフラストラクチャ（DBマイグレーション）
    - スキーマ変更（マイグレーション）管理
- ユースケース
    - アプリケーションサービス
    - リポジトリ/Unit of Work のインターフェース定義
    - ドメインエンティティと入出力 DTO の橋渡し
- ドメイン
    - エンティティ、値オブジェクト（例: `Unit`）
    - ドメイン表現の中心

## 4. フロントエンドアーキテクチャ（`frontend/`）

### 4.1 レイヤ構成と責務

アトミックデザインを採用し、各層の責務を以下のように分類する。

- ATOMS
    - 基本的な UI コンポーネント（例: ボタン、入力フィールド、ラベル）
- MOLECULES
    - 複数の ATOMS を組み合わせたコンポーネント（例: フォーム、カード）
- ORGANISMS
    - 複数の MOLECULES を組み合わせたコンポーネント（例: ヘッダー、サイドバー）
- TEMPLATES
    - ページのレイアウトを定義するコンポーネント（例: ダッシュボードレイアウト）
- PAGES
    - ルーティングされるページコンポーネント（例: ログインページ、可視化ページ）

## 5. 今後の設計論点（未確定）

- 同一送信元の判定方法（`device_id` 等）とレート制御エラー仕様
- API 送信元認証（JWT）導入のタイミングと移行方針
- フロントエンドの保護ページ導線（未ログイン時リダイレクト含む）
- 可視化画面の API クライアント層の配置と責務

